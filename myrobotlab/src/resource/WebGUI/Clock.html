<!-- only load once in myrobotlab.html
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>clock - Clock</title>
<link rel="stylesheet" href="common/themes/vader/jquery-ui.css" />
<link rel="stylesheet" href="common/style.css">
<script src="common/js/jquery-1.10.2.min.js"></script>
<script src="common/js/jquery-ui.min.1.10.3.js"></script>
<script src="common/js/jquery.websocket-0.0.1.js"></script>
<script src="http://jquery-json.googlecode.com/files/jquery.json-2.2.min.js"></script>
-->
<script>
	var boundServiceName = "clock";

	//-------ClockGUI begin---------
	//subclass extends superclass -- if you don't want ClockGUI's constructor - remove it
	function ClockGUI(name) {
		ServiceGUI.call(this, name); //call super constructor.
	}

	ClockGUI.prototype = Object.create(ServiceGUI.prototype);
	ClockGUI.prototype.constructor = ClockGUI;

	// callbacks
	ClockGUI.prototype.pulse = function(data) {
		$("#display").html(data);
	};

	ClockGUI.prototype.getState = function(data) {
		$("#display").html(data);
		if (data[0].isClockRunning) {
			$("#startClock").button("option", "label", "stop clock");
		} else {
			$("#startClock").button("option", "label", "start clock");
		}

		$("#interval").val(data[0].interval);
	};

	// overrides
	ClockGUI.prototype.attachGUI = function() {
		this.subscribe("pulse", "pulse");
		this.subscribe("publishState", "getState");
		// broadcast the initial state
		this.send("broadcastState");
	};

	// AHHHHH! this at the "top" does not work 
	// but moved to the bottom it suddenly understands inheritance !!!
	/*
	var clockGUI = new ClockGUI(boundServiceName);
	registry[boundServiceName] = clockGUI;
	 */

	//-------ClockGUI end---------
	// TODO - jquery best practices - anonymous functions are to be avoided
	ClockGUI.prototype.init = function() {
		$(function() {
			$("#startClock").button().click(function(event) {
				if ($(this).text() == "start clock") {
					$(this).button("option", "label", "stop clock");
					this.send("startClock", null); // FIXME null shouldn't be required
				} else {
					$(this).button("option", "label", "start clock");
					this.send("stopClock", null);
				}

				this.send("broadcastState");
			});
		});

		$(function() {
			$("#setInterval").button().click(
					function(event) {
						this.send("setInterval", [ parseInt($("#interval")
								.val()) ]);
						this.send("broadcastState");
					});
		});

	};
</script>

<!-- Clock panel begin -->
<div>
	<div id="display"></div>
	<button id="startClock">start clock</button>
	<button id="setInterval">set interval</button>
	interval <input id="interval" type="text" value="1000"></input>ms
</div>
<!-- Clock panel begin -->
